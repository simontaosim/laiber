!function(e,t){"use strict";Foundation.libs["magellan-expedition"]={name:"magellan-expedition",version:"5.5.2",settings:{active_class:"active",threshold:0,destination_threshold:20,throttle_delay:30,fixed_top:0,offset_by_height:!0,duration:700,easing:"swing"},init:function(e,t,n){Foundation.inherit(this,"throttle"),this.bindings(t,n)},events:function(){var t=this,n=t.S,i=t.settings;t.set_expedition_position(),n(t.scope).off(".magellan").on("click.fndtn.magellan","["+t.add_namespace("data-magellan-arrival")+"] a[href*=#]",function(n){var i=this.hostname===location.hostname||!this.hostname,o=t.filterPathname(location.pathname)===t.filterPathname(this.pathname),a=this.hash.replace(/(:|\.|\/)/g,"\\$1"),s=this;if(i&&o&&a){n.preventDefault();var r=e(this).closest("["+t.attr_name()+"]"),l=r.data("magellan-expedition-init"),c=this.hash.split("#").join(""),d=e('a[name="'+c+'"]');0===d.length&&(d=e("#"+c));var u=d.offset().top-l.destination_threshold+1;l.offset_by_height&&(u-=r.outerHeight()),e("html, body").stop().animate({scrollTop:u},l.duration,l.easing,function(){history.pushState?history.pushState(null,null,s.pathname+"#"+c):location.hash=s.pathname+"#"+c})}}).on("scroll.fndtn.magellan",t.throttle(this.check_for_arrivals.bind(this),i.throttle_delay))},check_for_arrivals:function(){var e=this;e.update_arrivals(),e.update_expedition_positions()},set_expedition_position:function(){var t=this;e("["+this.attr_name()+"=fixed]",t.scope).each(function(){var n,i,o=e(this),a=o.data("magellan-expedition-init"),s=o.attr("styles");o.attr("style",""),n=o.offset().top+a.threshold,i=parseInt(o.data("magellan-fixed-top")),isNaN(i)||(t.settings.fixed_top=i),o.data(t.data_attr("magellan-top-offset"),n),o.attr("style",s)})},update_expedition_positions:function(){var n=this,i=e(t).scrollTop();e("["+this.attr_name()+"=fixed]",n.scope).each(function(){var t=e(this),o=t.data("magellan-expedition-init"),a=t.attr("style"),s=t.data("magellan-top-offset");if(i+n.settings.fixed_top>=s){var r=t.prev("["+n.add_namespace("data-magellan-expedition-clone")+"]");0===r.length&&(r=t.clone(),r.removeAttr(n.attr_name()),r.attr(n.add_namespace("data-magellan-expedition-clone"),""),t.before(r)),t.css({position:"fixed",top:o.fixed_top}).addClass("fixed")}else t.prev("["+n.add_namespace("data-magellan-expedition-clone")+"]").remove(),t.attr("style",a).css("position","").css("top","").removeClass("fixed")})},update_arrivals:function(){var n=this,i=e(t).scrollTop();e("["+this.attr_name()+"]",n.scope).each(function(){var t=e(this),o=t.data(n.attr_name(!0)+"-init"),a=n.offsets(t,i),s=t.find("["+n.add_namespace("data-magellan-arrival")+"]"),r=!1;a.each(function(e,i){if(i.viewport_offset>=i.top_offset){var a=t.find("["+n.add_namespace("data-magellan-arrival")+"]");return a.not(i.arrival).removeClass(o.active_class),i.arrival.addClass(o.active_class),r=!0,!0}}),r||s.removeClass(o.active_class)})},offsets:function(t,n){var i=this,o=t.data(i.attr_name(!0)+"-init"),a=n;return t.find("["+i.add_namespace("data-magellan-arrival")+"]").map(function(){var n=e(this).data(i.data_attr("magellan-arrival")),s=e("["+i.add_namespace("data-magellan-destination")+"="+n+"]");if(s.length>0){var r=s.offset().top-o.destination_threshold;return o.offset_by_height&&(r-=t.outerHeight()),r=Math.floor(r),{destination:s,arrival:e(this),top_offset:r,viewport_offset:a}}}).sort(function(e,t){return e.top_offset<t.top_offset?-1:e.top_offset>t.top_offset?1:0})},data_attr:function(e){return this.namespace.length>0?this.namespace+"-"+e:e},off:function(){this.S(this.scope).off(".magellan"),this.S(t).off(".magellan")},filterPathname:function(e){return e=e||"",e.replace(/^\//,"").replace(/(?:index|default).[a-zA-Z]{3,4}$/,"").replace(/\/$/,"")},reflow:function(){var t=this;e("["+t.add_namespace("data-magellan-expedition-clone")+"]",t.scope).remove()}}}(jQuery,window,window.document);